---
import { getCollection } from 'astro:content';
import { siteConfig } from '../../data/site-config';

const services = await getCollection('services');
const sortedServices = services.sort((a, b) => a.data.order - b.data.order);
const { servicesSection } = siteConfig.valuePageV2;
---

<section id="services" class="svc" aria-labelledby="svc-heading">
  <div class="svc-wrap">

    <header class="svc-header">
      <p class="svc-kicker">Services</p>
      <h2 id="svc-heading" class="svc-title">{servicesSection.title}</h2>
      <p class="svc-lead">{servicesSection.intro}</p>
    </header>

    <div class="svc-grid">
      {sortedServices.map((service, i) => (
        <article class="svc-card" data-idx={i}>

          <div class="svc-card-meta">
            <span class="svc-num">0{i + 1}</span>
            <span class="svc-fmt">{service.data.format}</span>
          </div>

          <div class="svc-info">
            <h3 class="svc-name">{service.data.title}</h3>
            <p class="svc-hook">{service.data.hook}</p>
            <p class="svc-result">
              <span class="result-chip">Result</span>
              {service.data.outcome}
            </p>
          </div>

          <ul class="svc-list" aria-label="What you get">
            {service.data.deliverables.map((d) => (
              <li><span class="svc-dot" aria-hidden="true"></span>{d}</li>
            ))}
          </ul>

          <button
            class="svc-cta"
            onclick={`window.dispatchEvent(new CustomEvent('open-lead-modal', { detail: { service: '${service.data.title}' } }))`}
            aria-label={`Request scope for ${service.data.title}`}
          >
            {service.data.ctaText}
            <svg width="13" height="13" viewBox="0 0 13 13" fill="none" aria-hidden="true">
              <path d="M2 6.5h9M7.5 3L11 6.5 7.5 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

        </article>
      ))}
    </div>

  </div>
</section>

<style>
  /* ── Section ───────────────────────────────────────────── */
  .svc {
    background: linear-gradient(180deg, #070b14 0%, #0a0f1e 100%);
    padding: 6.5rem 0 7.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  .svc-wrap {
    max-width: 72rem;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* ── Header ────────────────────────────────────────────── */
  .svc-header {
    max-width: 52rem;
    margin: 0 auto 5rem;
    text-align: center;
  }

  .svc-kicker {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.68rem;
    font-weight: 700;
    letter-spacing: 0.26em;
    text-transform: uppercase;
    color: #38bdf8;
    margin-bottom: 1.125rem;
  }

  .svc-title {
    font-family: 'Inter', sans-serif;
    font-size: clamp(1.5rem, 2.75vw, 2.125rem);
    font-weight: 700;
    color: #f4f7fb;
    letter-spacing: -0.025em;
    line-height: 1.22;
    margin-bottom: 1.375rem;
  }

  .svc-lead {
    font-size: 1.0625rem;
    line-height: 1.75;
    color: #8fa3bc;
    max-width: 44rem;
    margin: 0 auto;
  }

  /* ── Grid ──────────────────────────────────────────────── */
  .svc-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.25rem;
  }

  @media (min-width: 768px) {
    .svc-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  /* ── Card ──────────────────────────────────────────────── */
  .svc-card {
    display: flex;
    flex-direction: column;
    gap: 1.375rem;
    padding: 2rem;
    background: rgba(12, 18, 33, 0.85);
    border: 1px solid rgba(255, 255, 255, 0.07);
    border-radius: 1rem;
    /* Scroll reveal: hidden by default */
    opacity: 0;
    transform: translateY(28px);
    will-change: transform, opacity;
    /* Hover transitions */
    transition:
      border-color 0.3s ease,
      transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1),
      box-shadow 0.3s ease;
  }

  .svc-card.is-visible {
    opacity: 1;
    transform: translateY(0);
    transition:
      opacity 0.55s cubic-bezier(0.2, 0.8, 0.2, 1),
      transform 0.55s cubic-bezier(0.2, 0.8, 0.2, 1),
      border-color 0.3s ease,
      box-shadow 0.3s ease;
  }

  .svc-card:hover {
    border-color: rgba(56, 189, 248, 0.28);
    transform: translateY(-4px);
    box-shadow:
      0 0 0 1px rgba(56, 189, 248, 0.1),
      0 16px 48px rgba(0, 0, 0, 0.4),
      0 4px 16px rgba(56, 189, 248, 0.06);
  }

  /* ── Card Meta row ─────────────────────────────────────── */
  .svc-card-meta {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .svc-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    font-weight: 700;
    color: #38bdf8;
    background: rgba(56, 189, 248, 0.1);
    border: 1px solid rgba(56, 189, 248, 0.22);
    border-radius: 0.375rem;
    padding: 0.2rem 0.5rem;
    letter-spacing: 0.06em;
  }

  .svc-fmt {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    color: #546070;
    letter-spacing: 0.04em;
  }

  /* ── Service Info ──────────────────────────────────────── */
  .svc-info {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
  }

  .svc-name {
    font-family: 'Inter', sans-serif;
    font-size: 1.375rem;
    font-weight: 700;
    color: #f4f7fb;
    letter-spacing: -0.02em;
    line-height: 1.22;
    margin: 0;
  }

  .svc-hook {
    font-size: 0.9375rem;
    font-weight: 600;
    color: #38bdf8;
    line-height: 1.5;
    margin: 0;
  }

  .svc-result {
    font-size: 0.875rem;
    color: #b5c9dc;
    line-height: 1.65;
    margin: 0;
  }

  .result-chip {
    display: inline-block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: #22c55e;
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.2);
    border-radius: 0.25rem;
    padding: 0.1rem 0.375rem;
    margin-right: 0.5rem;
    vertical-align: middle;
    position: relative;
    top: -1px;
  }

  /* ── Deliverables list ─────────────────────────────────── */
  .svc-list {
    list-style: none;
    margin: 0;
    padding: 1.25rem 0 0;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    flex: 1;
  }

  .svc-list li {
    display: flex;
    align-items: flex-start;
    gap: 0.625rem;
    font-size: 0.8125rem;
    color: #8fa3bc;
    line-height: 1.6;
  }

  .svc-dot {
    flex-shrink: 0;
    width: 4px;
    height: 4px;
    margin-top: 0.475rem;
    border-radius: 50%;
    background: #38bdf8;
  }

  /* ── CTA button ────────────────────────────────────────── */
  .svc-cta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.75rem 1.5rem;
    background: transparent;
    border: 1px solid rgba(56, 189, 248, 0.3);
    border-radius: 0.5rem;
    font-family: 'Inter', sans-serif;
    font-size: 0.875rem;
    font-weight: 600;
    color: #7dd3fc;
    cursor: pointer;
    margin-top: auto;
    transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
  }

  .svc-cta:hover {
    background: rgba(56, 189, 248, 0.1);
    border-color: rgba(56, 189, 248, 0.5);
    color: #bae6fd;
  }

  .svc-cta:focus-visible {
    outline: 2px solid #38bdf8;
    outline-offset: 3px;
  }

  /* ── Responsive ────────────────────────────────────────── */
  @media (max-width: 767px) {
    .svc {
      padding: 4.5rem 0 5rem;
    }

    .svc-header {
      margin-bottom: 3rem;
    }

    .svc-card {
      padding: 1.625rem;
    }
  }
</style>

<script>
  const cards = Array.from(document.querySelectorAll<HTMLElement>('.svc-card'));

  const reveal = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const el = entry.target as HTMLElement;
          const idx = parseInt(el.dataset.idx ?? '0', 10);
          setTimeout(() => el.classList.add('is-visible'), idx * 110);
          reveal.unobserve(el);
        }
      });
    },
    { threshold: 0.08, rootMargin: '0px 0px -32px 0px' }
  );

  cards.forEach((card) => reveal.observe(card));
</script>
