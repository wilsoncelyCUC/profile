---
interface Props {
  service: {
    title: string;
    slug: string;
    icon: 'rocket' | 'lightbulb' | 'trending-up';
    hook: string;
    tagline: string;
    bestFor: string;
    outcome: string;
    deliverables: string[];
    format: string;
    ctaText: string;
  };
  delay?: number;
}

const { service, delay = 0 } = Astro.props;

const serviceParam = service.slug || service.title.toLowerCase().replace(/\s+/g, '-');

// Icon SVG paths - using proper Heroicons paths
const icons = {
  rocket: 'M15.59 14.37a6 6 0 0 1-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 0 0 6.16-12.12A14.98 14.98 0 0 0 9.631 8.41m5.96 5.96a14.926 14.926 0 0 1-5.841 2.58m-.119-8.54a6 6 0 0 0-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 0 0-2.58 5.84m2.699 2.7c-.103.021-.207.041-.311.06a15.09 15.09 0 0 1-2.448-2.448 14.9 14.9 0 0 1 5.06-5.06m-2.699 2.7c.103.021.207.041.311.06a15.09 15.09 0 0 1 2.448-2.448 14.9 14.9 0 0 1 5.06-5.06m-2.699 2.7c.103.021.207.041.311.06a15.09 15.09 0 0 1-2.448-2.448 14.9 14.9 0 0 1 5.06-5.06',
  lightbulb: 'M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m4.5 0a12.05 12.05 0 0 0 1.5-.189M12 12.75V18m-3.75-5.25a6.01 6.01 0 0 0-1.5-.189m1.5.189a6.01 6.01 0 0 1-1.5-.189M9.75 18a12.05 12.05 0 0 1-1.5-.189m1.5.189a12.05 12.05 0 0 0 1.5-.189M9.75 18v-5.25m0 0a6.01 6.01 0 0 1-1.5-.189m1.5.189a6.01 6.01 0 0 0-1.5-.189M9.75 12.75h-3m3 0h3m-3 0v-3.375c0-.621.503-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125V12.75m-6-3.375c0-.621.503-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125V12.75m-6-3.375c0-.621.503-1.125 1.125-1.125h1.5c.621 0 1.125.504 1.125 1.125V12.75',
  'trending-up': 'M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941',
};

const iconPath = icons[service.icon];
---

<article
  x-data="{
    visible: true,
    expanded: false,
    isMobile: false,
    serviceSlug: '${service.slug}'
  }"
  x-init="
    isMobile = window.innerWidth < 768;
    window.addEventListener('resize', () => { isMobile = window.innerWidth < 768 });
  "
  x-intersect:enter="visible = true"
  @service-expand.window="
    if (isMobile && $event.detail.slug !== serviceSlug) {
      expanded = false;
    }
  "
  @click.self="
    if (isMobile) {
      const wasExpanded = expanded;
      expanded = !expanded;
      if (expanded) {
        $dispatch('service-expand', { slug: serviceSlug });
      } else if (wasExpanded) {
        $dispatch('service-expand', { slug: null });
      }
    }
  "
  @mouseenter="if (!isMobile) expanded = true"
  @mouseleave="if (!isMobile) expanded = false"
  :class="{
    'opacity-100 translate-y-0': visible,
    'opacity-0 translate-y-5': !visible
  }"
  class="relative rounded-2xl p-8 flex flex-col transition-all duration-300 ease-out cursor-pointer group h-full opacity-100 bg-white border-2 border-primary-light"
  style={`
    box-shadow: 0 4px 12px rgba(43, 168, 163, 0.15);
    min-height: 400px;
    opacity: 1;
    transform: translateY(0);
  `}
  :style="expanded && !isMobile ? {
    boxShadow: '0 12px 24px rgba(43, 168, 163, 0.25)',
    transform: 'translateY(-8px)',
    minHeight: '520px',
    borderColor: 'var(--primary)'
  } : {}"
  role="article"
  :aria-expanded="expanded"
  aria-label={`Service: ${service.title}`}
>
  <!-- Icon -->
  <div class="mb-6">
    <svg
      class="w-12 h-12 text-primary"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="1.5"
      aria-hidden="true"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d={iconPath}
      />
    </svg>
  </div>

  <!-- Service Name -->
  <h3 class="text-2xl font-bold text-text-dark mb-3">
    {service.title}
  </h3>

  <!-- Hook / Best For (Most Prominent) -->
  <p class="text-lg font-semibold text-primary mb-2 leading-tight">
    {service.hook}
  </p>

  <!-- Tagline (Collapsed View) -->
  <p
    :class="{ 'hidden': expanded }"
    class="text-base text-text-dark/70 mb-6 block"
  >
    {service.tagline}
  </p>

  <!-- Expanded Content -->
  <div
    x-show="expanded"
    x-cloak
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 max-h-0"
    x-transition:enter-end="opacity-100 max-h-96"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100 max-h-96"
    x-transition:leave-end="opacity-0 max-h-0"
    class="flex-1 space-y-4 mb-6 overflow-hidden"
  >
    <!-- Outcome -->
    <div>
      <p class="text-base font-medium text-text-dark leading-relaxed">
        {service.outcome}
      </p>
    </div>

    <!-- Deliverables -->
    <div>
      <p class="text-sm font-semibold text-primary uppercase tracking-wide mb-2">
        What you get:
      </p>
      <ul class="space-y-2">
        {service.deliverables.map((item) => (
          <li class="text-sm text-text-dark/80 flex items-start">
            <span class="text-primary mr-2 flex-shrink-0">•</span>
            <span>{item}</span>
          </li>
        ))}
      </ul>
    </div>

    <!-- Format -->
    <div>
      <p class="text-sm italic text-text-dark/60">
        Format: {service.format}
      </p>
    </div>
  </div>

  <!-- CTA Button -->
  <a
    href={`#contact?service=${serviceParam}`}
    class="mt-auto inline-block text-center bg-primary text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 hover:bg-primary/90 hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-transparent"
    @click.stop
    aria-label={`Request scope for ${service.title}`}
  >
    {service.ctaText} →
  </a>
</article>

<style>
  /* Smooth collapse animation */
  [x-cloak] {
    display: none !important;
  }

  /* Ensure cards are visible by default, even before Alpine.js initializes */
  article[x-data] {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
</style>
